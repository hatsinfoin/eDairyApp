<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-img (click)="routePage('landingPage')" class="eDairyHeadderHomeIcon"
                   src="../../assets/images/SchooleDairyIcon.png"></ion-img>
        </ion-col>
        <ion-col size="8" class="custom-col ion-text-center">eDairy</ion-col>
        <ion-col></ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card *ngFor="let dairy of eDairyList">
    <ion-card-header (click)="toggleExpand(dairy.id!)" style="cursor: pointer;">
      <ion-card-title>{{ dairy.eDairyDetails?.title }}</ion-card-title>
      <ion-card-subtitle>{{ formatDate(dairy.dateOfAssignment) }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content *ngIf="isExpanded(dairy.id!)">
      <p>{{ dairy.eDairyDetails?.description }}</p>

      <div *ngIf="dairy.eDairyDetails?.attachments?.length">
        <h5>Attachments</h5>
        <ion-list>
          <ion-item *ngFor="let att of dairy.eDairyDetails.attachments">
            <ion-label>
              <a [href]="att.fileUrl" target="_blank">{{ att.fileName }}</a>
              <p>Uploaded: {{ formatDate(att.uploadedOn) }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>

      <div *ngIf="dairy.comments?.length">
        <ion-card>
          <ion-card-header>
            <ion-card-title>General Comments</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let comment of dairy.comments">
                <ion-label>
                  <h6>{{ comment.userRole | titlecase }} ({{ comment.userId }})</h6>
                  <p>{{ comment.commentText }}</p>
                  <small>{{ formatDate(comment.timestamp) }}</small>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>

      <div *ngIf="dairy.studentSubmissions?.length">
        <ion-card *ngFor="let submission of dairy.studentSubmissions">
          <ion-card-header>
            <ion-card-title>
              {{ submission.studentName }} - {{ submission.submission.status | titlecase }}
            </ion-card-title>
            <ion-card-subtitle>
              Submitted: {{ formatDate(submission.submission.submittedDate) }}
            </ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <div *ngIf="submission.submission.grade">
              <p><strong>Grade:</strong> {{ submission.submission.grade.marks }}/{{ submission.submission.grade.maxMarks }}</p>
              <p><strong>Feedback:</strong> {{ submission.submission.grade.feedback }}</p>
            </div>

            <h6>Comments:</h6>
            <ion-list>
              <ion-item *ngFor="let c of submission.submission.comments">
                <ion-label>
                  <h6>{{ c.userName }} ({{ c.userType }})</h6>
                  <p>{{ c.comment }}</p>
                  <small>{{ formatDate(c.timestamp) }}</small>

                  <div *ngIf="c.attachments?.length">
                    <p>Attachments:</p>
                    <ul>
                      <li *ngFor="let file of c.attachments">
                        <a [href]="file.fileUrl" target="_blank">{{ file.fileName }}</a>
                      </li>
                    </ul>
                  </div>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>
